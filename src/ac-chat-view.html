<!--
    Profile Functions will be done here.
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="shared-styles.html">

<dom-module id="ac-chat-view">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        width: 100%;
      }
      .content{
        width: 100%;
        height: 100%;
        margin-bottom: 68px;
      }
      .input-area{
        display: flex;
        width: 100%;
        padding: 10px;
        height: 60px;
        align-items: flex-end;
        bottom: 0;
        position: fixed;
      }
      .input-area paper-textarea{
        width: 200px;
        margin-right: 5px;
      }
      .inputfile {
        width: 0.1px;
        height: 0.1px;
        opacity: 0;
        overflow: hidden;
        position: absolute;
        z-index: -1;
      }
      paper-fab{
        margin-left: 15px;
      }
      .chat-container{
        height: 400px;
        padding-top: 0;
        padding-bottom: 0;
      }
      .chat-wrap{
          display: flex;
          flex-direction: column;
          overflow-y: auto;
          margin-bottom: 10px;
          height: calc(100% - 10px);
      }
      .bubble{
        min-width: 50px;
        margin: 10px;
        padding: 10px;
        position: relative;
      }
      .self {
        color: #fff;
        align-self: flex-end !important;
        background: #03A9F4 !important;
        border-radius: 10px 10px 0px 10px!important;
      }
      .other {
        color: #03A9F4;
        align-self: flex-start !important;
        background: #dedefe !important;
        border-radius:  10px 10px 10px 0px !important;
      }
      .chat-time{
        margin-left: 15px;
        font-size: 10pt;
        color:inherit;
      }
    </style>
    <app-route
        route="{{route}}"
        pattern="/:user_name"
        data="{{routeData}}"></app-route>

    <div class="content">
      <a href="chat">
        <paper-icon-button icon="ac-icons:arrow-back"></paper-icon-button>Chat with {{routeData.user_name}}
      </a>

      <div class="chat-container">
        <div id="messageList" class="chat-wrap">
            <template is="dom-repeat" items="[[messages]]">
              <div class="bubble" on-tap="_selectUser" user={{item}} href="chat-view/{{item.name.first}}" name="chat-view">
                  <div class="chat-text">{{item.text}} <span class="chat-time">{{item.time}}</span></div>
              </div>
            </template>
        </div>
      </div>
      
      <div class="input-area">
        <paper-textarea id="text" placeholder="Type your message"></paper-textarea>
        <input type="file" name="file" id="file" class="inputfile" />
        <label for="file"><iron-icon icon="ac-icons:add-a-photo"></iron-icon></label>
        <!--<paper-icon-button icon="ac-icons:add-a-photo"></paper-icon-button>-->
        <paper-fab on-tap="_sendMsg" icon="ac-icons:send"></paper-fab>
      </div>
    </div>    
  </template>

  <script>
    class AcChatView extends Polymer.Element {
      static get is() { return 'ac-chat-view'; }
      static get properties() {
        return {
            user: {
                type: Object,
                notify: true
            },
            messages : {
              type: Array,
              value: function(){
                return [];
              },
              observer: '_msgAdded'
            },
            routeData: Object
        };
      }
      _sendMsg(){
        var messageList = this.$.messageList;
        var text = this.$.text.value;
        if(text === ""){
          console.log('No text!')
        }else if(text === undefined){
          console.log('No text!')
        }else{
          this.push('messages', {
            text:text,
            time: "just now"
            });
        }
        this.$.text.value = "";
        setTimeout(function(){
          messageList.scrollTop = messageList.scrollHeight;
        }, 100);
       
        console.log(this.messages);
      }

      log(){
        console.log(this.routeData)
      }

      attached(){
        //this.$.messageList.scrollTop = this.$.messageList.height;
      }
    }

    window.customElements.define(AcChatView.is, AcChatView);
  </script>
</dom-module>

